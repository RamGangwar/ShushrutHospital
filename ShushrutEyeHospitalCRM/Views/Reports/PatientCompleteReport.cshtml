@using System.Security.Claims;
@model Tuple<PatientViewModel,IEnumerable<PatientHistoryViewModel>>
@{
    ViewData["Title"] = "PatientDetail";
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Patient CheckUp Detail</title>
    <link href="~/assets/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/dist/css/stylehealth.min.css" rel="stylesheet" type="text/css" />

    <style>

        .letter-head article {
            /*width:210mm;*/
            /* width: 100%;
                    height: auto;
                    margin: 20px auto;
                    position: relative;*/
            width: 95%;
            height: auto;
            margin: 20px auto;
            margin-left: 30px;
            margin-right: 20px;
        }

        .letter-head address {
            text-align: right;
            padding: 0 15px 0 0;
            bottom: 8mm;
            right: 20mm;
        }

        .letter-head .ccc h5 {
            margin: 6px 0;
        }

        .letter-head .ccc, address {
            color: #000000 !important;
        }

            .letter-head .ccc h3 {
                margin: 3px 0;
            }

        .letter-head h1 {
            top: 12mm;
            left: 20mm;
            width: 221px;
            height: 149px;
            font-size: 20px;
            letter-spacing: 1px;
            text-align: center;
            padding: 0px 0;
            color: white;
            line-height: 9;
            text-shadow: 1px 1px 1px black;
        }

        .letter-head .head {
            display: flex;
            align-items: center;
            /*gap: 30px;*/
            gap: 55%;
            padding: 0 0%;
            background-color: #ededed;
        }
        /* Your CSS below here */
        .letter-head article {
            background-color: #fff;
            border-top: 5px solid #b30000;
            border-bottom: 5px solid #b30000;
        }

        .letter-head h1 {
            box-shadow: 5px 5px 1px rgba(0,0,0,0.7);
            border-radius: 50%;
            overflow: hidden;
            background-color: #31349d;
        }

        .letter-head .contant {
            padding: 0px 15px;
        }

        .head img {
            padding: 50px 0 50px 0;
        }

        tbody th {
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="letter-head">
        <article>

            <div style="width:100%">

                <table class="table" style="text-align:center;border:none;">
                    <tr>
                        <td style="vertical-align:middle; border:none;padding:0;"><img src="~/images/logobig.jpg" alt="" style="width: 100%; height:70px"></td>

                    </tr>
                    <tr>
                        <td style="border:none;padding:0;">
                            @*<h3>Sushrut Eye Hospital<br></h3>*@
                            <h5><b>Address-</b>Plot no 5 , 1st Floor, Ishwarpuri, Sector 12 Indra Nagar, Lucknow-226016 <b>Phone-</b>9026353723 (Whatsapp)</h5>
                        </td>
                    </tr>

                </table>


            </div>
            @*<div class="head">
            <table class="table">
            <tr>
            <td><img src="~/images/logo.png" alt="" style="width: 200px;"></td>
            <td>
            <div class="ccc ms-auto pr-3 text-center text-white">
            <h3>Sushrut Eye Hospital<br></h3>
            <h5>Plot no 5 , 1st Floor, Ishwarpuri, Sector 12 Indra Nagar, Lucknow-226016</h5>
            <b>Phone-</b>9026353723 (Whatsapp)<br>

            </div>
            </td>

            </tr>

            </table>

            </div>*@
            <div class="contant">
                <div class="tables-container">
                    @{
                        var age = Convert.ToUInt32(System.DateTime.Today.Year) - Convert.ToInt32(Model.Item1.DOB!.Value.Year);
                    }
                    @{
                        var gender = Model.Item1.Gender == "1" ? "Male" : "Female";
                    }
                    <table class="table table-bordered">
                        <tr>
                            <th colspan="2" class="text-center">Patients Details</th>
                            <td colspan="2" class="text-right"><b>MRD No</b> @Model.Item1.MRDNo</td>
                        </tr>
                        <tr>
                            <th>Name</th>
                            <td>@Model.Item1.ApplicationUser!.FirstName &nbsp;@Model.Item1.ApplicationUser.LastName</td>
                            <th>Mobile</th>
                            <td>@Model.Item1.ApplicationUser.PhoneNumber</td>
                        </tr>
                        <tr>
                            <th>Address</th>
                            <td>@Model.Item1.Address</td>
                            <th>Age/Gender</th>
                            <td>@age Yrs/ @gender</td>
                        </tr>
                        <tr>
                            <th>OPD Date</th>
                            <td>@Model.Item1.RegDate</td>
                            <th>Print Date</th>
                            <td>@System.DateTime.Now.ToString("dd/MM/yyyy hh:mm tt")</td>
                        </tr>
                    </table>
                </div>
                <div class="tables-container">
                    <table class="table table-bordered">
                        <tr>
                            <th colspan="4" class="text-center">Current Eye Problem</th>
                        </tr>
                        <tr>
                            <td>
                                @{
                                    var prob = Model.Item1.Problem == "Other" ? Model.Item1.OtherProblem : Model.Item1.Problem;
                                }
                                @prob
                            </td>
                        </tr>
                    </table>
                </div>

                @{
                    foreach (var item in Model.Item2)
                    {
                        if (!string.IsNullOrEmpty(item.DistanceVisionREWithGlass) ||
                        !string.IsNullOrEmpty(item.DistanceVisionREWithPinhole) ||
                        !string.IsNullOrEmpty(item.DistanceVisionLEWithGlass) ||
                        !string.IsNullOrEmpty(item.DistanceVisionLEWithPinhole) ||
                        !string.IsNullOrEmpty(item.DistanceVisionREUnAided) ||
                        !string.IsNullOrEmpty(item.DistanceVisionLEUnAided) ||
                        !string.IsNullOrEmpty(item.NearVisionREUnAided) ||
                        !string.IsNullOrEmpty(item.NearVisionLEUnAided) ||
                        !string.IsNullOrEmpty(item.NearVisionREWithGlass) ||
                        !string.IsNullOrEmpty(item.NearVisionREWithPinhole) ||
                        !string.IsNullOrEmpty(item.NearVisionLEWithGlass) ||
                        !string.IsNullOrEmpty(item.NearVisionLEWithPinhole))
                        {
                            <div class="tables-container">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th class="text-center">Vision</th>
                                            <th colspan="2" class="text-center">Distance Vision</th>
                                            <th colspan="2" class="text-center">Near Vision</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td></td>
                                            <th class="column text-center">Right Eye</th>
                                            <th class="column text-center">Left Eye</th>
                                            <th class="column text-center">Right Eye</th>
                                            <th class="column text-center">Left Eye</th>
                                        </tr>
                                        @if (!string.IsNullOrEmpty(item.DistanceVisionREUnAided) ||
                                   !string.IsNullOrEmpty(item.DistanceVisionLEUnAided) ||
                                   !string.IsNullOrEmpty(item.NearVisionREUnAided) ||
                                   !string.IsNullOrEmpty(item.NearVisionLEUnAided))
                                        {
                                            <tr>
                                                <th class="text-center">UnAided</th>
                                                <td class="text-center">@item.DistanceVisionREUnAided</td>
                                                <td class="text-center">@item.DistanceVisionLEUnAided</td>
                                                <td class="text-center">@item.NearVisionREUnAided</td>
                                                <td class="text-center">@item.NearVisionLEUnAided</td>
                                            </tr>
                                        }
                                        @if (!string.IsNullOrEmpty(item.DistanceVisionREWithGlass) ||
                                   !string.IsNullOrEmpty(item.DistanceVisionLEWithGlass) ||
                                   !string.IsNullOrEmpty(item.NearVisionREWithGlass) ||
                                   !string.IsNullOrEmpty(item.NearVisionLEWithGlass))
                                        {
                                            <tr>
                                                <th class="text-center">With Glass</th>
                                                <td class="text-center">@item.DistanceVisionREWithGlass</td>
                                                <td class="text-center">@item.DistanceVisionLEWithGlass</td>
                                                <td class="text-center">@item.NearVisionREWithGlass</td>
                                                <td class="text-center">@item.NearVisionLEWithGlass</td>
                                            </tr>
                                        }
                                        @if (!string.IsNullOrEmpty(item.DistanceVisionREWithPinhole) ||
                                   !string.IsNullOrEmpty(item.DistanceVisionLEWithPinhole) ||
                                   !string.IsNullOrEmpty(item.NearVisionREWithPinhole) ||
                                   !string.IsNullOrEmpty(item.NearVisionLEWithPinhole))
                                        {
                                            <tr>
                                                <th class="text-center">With Pinhole</th>
                                                <td class="text-center">@item.DistanceVisionREWithPinhole</td>
                                                <td class="text-center">@item.DistanceVisionLEWithPinhole</td>
                                                <td class="text-center">@item.NearVisionREWithPinhole</td>
                                                <td class="text-center">@item.NearVisionLEWithPinhole</td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                                @if (!string.IsNullOrEmpty(item.MethodName) ||
                           !string.IsNullOrEmpty(item.IOPTime) ||
                           !string.IsNullOrEmpty(item.IOPRE) ||
                           !string.IsNullOrEmpty(item.IOPLE) ||
                           !string.IsNullOrEmpty(item.PRE) ||
                           !string.IsNullOrEmpty(item.PLE) ||
                           !string.IsNullOrEmpty(item.Remarks))
                                {
                                    <table class="table table-bordered">
                                        <tbody>
                                            <tr>
                                                <th class="text-center">Method name</th>
                                                <th class="text-center">IOP Time</th>
                                                <th class="text-center">IOP RE</th>
                                                <th class="text-center">IOPLE</th>
                                                <th class="text-center">P RE</th>
                                                <th class="text-center">P LE</th>
                                                <th class="text-center">REMARKS</th>
                                            </tr>
                                            <tr>
                                                <td class="text-center">@item.MethodName</td>
                                                <td class="text-center">@item.IOPTime</td>
                                                <td class="text-center">@item.IOPRE</td>
                                                <td class="text-center">@item.IOPLE</td>
                                                <td class="text-center">@item.PRE</td>
                                                <td class="text-center">@item.PLE</td>
                                                <td class="text-center">@item.Remarks</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                }
                                @{

                                    if (item.PatientAdvGlasses != null && (!string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceRE_Sph) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceRE_Cy) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceRE_Axis) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceRE_Prism) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceRE_VA) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceRE_NV) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceLE_Sph) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceLE_Cy) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceLE_Axis) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceLE_Prism) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceLE_VA) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceLE_NV) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddRE_Sph) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddRE_Cy) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddRE_Axis) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddRE_Prism) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddRE_VA) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddRE_NV) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddLE_Sph) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddLE_Cy) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddLE_Axis) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddLE_Prism) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddLE_VA) ||
                                    !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddLE_NV)))
                                    {
                                        <table class="table table-bordered" style="margin-bottom: 0px;">
                                            <tr>
                                                <td>Adv.Glasses</td>
                                                <td class="column text-center">Right Eye</td>
                                                <td class="column text-center">Left Eye</td>
                                            </tr>
                                            <tr>
                                                <td class="column"></td>
                                                <td class="column">
                                                    <table class="table table-bordered" style="margin-bottom: 0px;">
                                                        <tr>
                                                            <td class="text-center">Sph</td>
                                                            <td class="text-center">Cy</td>
                                                            <td class="text-center">Axis</td>
                                                            <td class="text-center">Prism</td>
                                                            <td class="text-center">V/A</td>
                                                            <td class="text-center">N/V</td>
                                                        </tr>

                                                    </table>
                                                </td>
                                                <td class="column">
                                                    <table class="table table-bordered" style="margin-bottom: 0px;">
                                                        <tr>
                                                            <td class="text-center">Sph</td>
                                                            <td class="text-center">Cy</td>
                                                            <td class="text-center">Axis</td>
                                                            <td class="text-center">Prism</td>
                                                            <td class="text-center">V/A</td>
                                                            <td class="text-center">N/V</td>
                                                        </tr>

                                                    </table>
                                                </td>
                                            </tr>
                                            @if (!string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceRE_Sph) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceRE_Cy) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceRE_Axis) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceRE_Prism) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceRE_VA) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceRE_NV) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceLE_Sph) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceLE_Cy) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceLE_Axis) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceLE_Prism) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceLE_VA) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.DistanceLE_NV))
                                            {
                                                <tr>
                                                    <td class="column">Distance</td>
                                                    <td class="column">
                                                        <table class="table table-bordered" style="margin-bottom: 0px;">
                                                            <tr>
                                                                <td class="text-center">@item.PatientAdvGlasses!.DistanceRE_Sph</td>
                                                                <td class="text-center">@item.PatientAdvGlasses!.DistanceRE_Cy</td>
                                                                <td class="text-center">@item.PatientAdvGlasses!.DistanceRE_Axis</td>
                                                                <td class="text-center">@item.PatientAdvGlasses!.DistanceRE_Prism</td>
                                                                <td class="text-center">@item.PatientAdvGlasses!.DistanceRE_VA</td>
                                                                <td class="text-center">@item.PatientAdvGlasses!.DistanceRE_NV</td>
                                                            </tr>

                                                        </table>
                                                    </td>
                                                    <td class="column">
                                                        <table class="table table-bordered" style="margin-bottom: 0px;">
                                                            <tr>
                                                                <td class="text-center">@item.PatientAdvGlasses!.DistanceLE_Sph</td>
                                                                <td class="text-center">@item.PatientAdvGlasses!.DistanceLE_Cy</td>
                                                                <td class="text-center">@item.PatientAdvGlasses!.DistanceLE_Axis</td>
                                                                <td class="text-center">@item.PatientAdvGlasses!.DistanceLE_Prism</td>
                                                                <td class="text-center">@item.PatientAdvGlasses!.DistanceLE_VA</td>
                                                                <td class="text-center">@item.PatientAdvGlasses!.DistanceLE_NV</td>
                                                            </tr>

                                                        </table>
                                                    </td>
                                                </tr>
                                            }
                                            @if (!string.IsNullOrEmpty(item.PatientAdvGlasses!.AddRE_Sph) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddRE_Cy) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddRE_Axis) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddRE_Prism) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddRE_VA) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddRE_NV) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddLE_Sph) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddLE_Cy) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddLE_Axis) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddLE_Prism) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddLE_VA) ||
                                   !string.IsNullOrEmpty(item.PatientAdvGlasses!.AddLE_NV))
                                            {
                                                <tr>
                                                    <td class="column">Add</td>
                                                    <td class="column">
                                                        <table class="table table-bordered" style="margin-bottom: 0px;">
                                                            <tr>
                                                                <td class="text-center">@item.PatientAdvGlasses!.AddRE_Sph</td>
                                                                <td class="text-center">@item.PatientAdvGlasses!.AddRE_Cy</td>
                                                                <td class="text-center">@item.PatientAdvGlasses!.AddRE_Axis</td>
                                                                <td class="text-center">@item.PatientAdvGlasses!.AddRE_Prism</td>
                                                                <td class="text-center">@item.PatientAdvGlasses!.AddRE_VA</td>
                                                                <td class="text-center">@item.PatientAdvGlasses!.AddRE_NV</td>
                                                            </tr>

                                                        </table>
                                                    </td>
                                                    <td class="column">
                                                        <table class="table table-bordered" style="margin-bottom: 0px;">
                                                            <tr>
                                                                <td class="text-center">@item.PatientAdvGlasses!.AddLE_Sph</td>
                                                                <td class="text-center">@item.PatientAdvGlasses!.AddLE_Cy</td>
                                                                <td class="text-center">@item.PatientAdvGlasses!.AddLE_Axis</td>
                                                                <td class="text-center">@item.PatientAdvGlasses!.AddLE_Prism</td>
                                                                <td class="text-center">@item.PatientAdvGlasses!.AddLE_VA</td>
                                                                <td class="text-center">@item.PatientAdvGlasses!.AddLE_NV</td>
                                                            </tr>

                                                        </table>
                                                    </td>
                                                </tr>
                                            }

                                        </table>
                                    }
                                }
                            </div>

                        }
                        @if (item.PatientExamination!.Count > 0)
                        {
                            <div class="tables-container" style="align-text:center">
                                <br>
                                <label class="control-label">Examination Detail</label>
                                <table class="table " style="margin-bottom: 0px; width:50%">
                                    <thead>
                                        <tr>
                                            <th class="text-center">Finding Name</th>
                                            <th class="text-center">Right Eye</th>
                                            <th class="text-center">Left Eye</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @{
                                            foreach (var itemexam in item.PatientExamination!)
                                            {
                                                <tr>
                                                    <td class="text-center">@itemexam.FindingName</td>
                                                    <td class="text-center">@itemexam.RightEye</td>
                                                    <td class="text-center">@itemexam.LeftEye</td>
                                                </tr>
                                            }
                                        }
                                    </tbody>

                                </table>

                            </div>
                        }
                        <br />
                        @if (!string.IsNullOrEmpty(item.Prescriptions))
                        {
                            <div class="tables-container">
                                <table class="table ">
                                    <tr>
                                        <td colspan="4" style="border:none;" class="text-left"><b>Plan of Care</b></td>
                                    </tr>
                                    <tr>
                                        <td style="border:none;">@Html.Raw(item.Prescriptions)</td>
                                    </tr>
                                </table>
                            </div>
                        }
                        @if (!string.IsNullOrEmpty(item.DoctorAdvice))
                        {
                            <div class="tables-container">
                                <table class="table">
                                    <tr>
                                        <td colspan="4" style="border:none;" class="text-left"><b>Rx</b></td>
                                    </tr>
                                    <tr>
                                        <td style="border:none;">@Html.Raw(item.DoctorAdvice)</td>
                                    </tr>
                                </table>
                            </div>
                        }
                        @if (!string.IsNullOrEmpty(item.Diagnosis))
                        {
                            <div class="tables-container">
                                <table class="table">
                                    <tr>
                                        <td colspan="4" style="border:none;" class="text-left"><b>Diagnosis</b></td>
                                    </tr>
                                    <tr>
                                        <td style="border:none;">@Html.Raw(item.Diagnosis)</td>
                                    </tr>
                                </table>
                            </div>
                        }
                    }
                }
            </div>
            <address style="height:130px">
                @{
                    var signature = string.IsNullOrEmpty(Model.Item1.Doctor!.Signature) ? "" : Model.Item1.Doctor!.Signature;
                }
                @if (!string.IsNullOrEmpty(signature))
                {
                    <img src="~/doctor/@signature" height="120" width="300" />
                }

            </address>
            @*<address>
            <p>Sushrut Eye Hospital</p>
            <p>
            Plot no 5 , 1st Floor, Ishwarpuri, Sector 12 Indra Nagar, Lucknow-226016<br>
            </p>
            </address>*@
        </article>
    </div>
    <script src="~/assets/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>

</body>
</html>